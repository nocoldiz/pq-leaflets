(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{213:function(e,t,a){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var l in t=arguments[a])Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l]);return e}).apply(this,arguments)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sortLeaflets=t.filterLeaflets=t.fetchLeaflets=void 0;var n=l(a(480)),i=a(222);t.fetchLeaflets=function(e,t){return function(a){a({type:i.ActionType.FETCH_LEAFLETS_PENDING,loading:!0}),n.default.get("https://pq-leaflets.herokuapp.com/api/leaflets/filter",{params:{offset:e.offset,limit:e.limit,name:e.name,excludeExpired:e.excludeExpired,retailerId:e.retailerId,maxDistance:e.maxDistance,sort:e.sort}}).then((function(e){var r=e.data,l=new Set;if(r.data.error)throw"error";var n=[];r.data.leaflets.forEach((function(e){n.push({id:e.retailer.id,name:e.retailer.name})})),n=n.filter((function(e){var t=l.has(e.id);return l.add(e.id),!t})),a({type:i.ActionType.FETCH_LEAFLETS_SUCCESS,loading:!1,refresh:t,retailers:n,payload:r})})).catch((function(e){console.error(e),a({type:i.ActionType.FETCH_LEAFLETS_ERROR,loading:!1,error:e})}))}};t.filterLeaflets=function(e,t){return function(a){var r=t.name.toUpperCase(),l=t.retailerId,n=0|t.maxDistance;t.offset<=0&&(t.offset=0),t.limit<=0&&(t.limit=0);var u=e.filter((function(e){return e.name.toUpperCase().indexOf(r)>=0||e.retailer.name.toUpperCase().indexOf(r)>=0})).filter((function(e){return""==l||e.retailer.id===l})).filter((function(e){return 0==n||e.retailer.distance<=n})).slice(t.offset,t.limit);if(1==t.excludeExpired){var f=new Date;console.log("filtering expired"),u=u.filter((function(e){var t=new Date(0);return t.setUTCSeconds(e.expTimestamp),t.getTime()>f.getTime()}))}console.log(u),console.log(t),a({type:i.ActionType.FILTER_LEAFLETS,filters:t,payload:u})}};t.sortLeaflets=function(e,t,a){return function(l){var n=a.sort.split(",");switch(t){case"priority":n[0]="priority";break;case"-priority":n[0]="-priority";break;case"expTimestamp":n[1]="expTimestamp";break;case"-expTimestamp":n[1]="-expTimestamp";break;case"distance":n[2]="distance";break;case"-distance":n[2]="-distance";break;case"retailerName":n[3]="retailerName";break;case"-retailerName":n[3]="-retailerName";break;case"leafletName":n[4]="leafletName";break;case"-leafletName":n[4]="-leafletName"}console.log(n),"priority"==n[0]&&(console.log("sort by priority"),e.sort((function(e,t){return e.retailer.priority-t.retailer.priority}))),"-priority"==n[0]&&(console.log("sort by -priority"),e.sort((function(e,t){return t.retailer.priority-t.retailer.priority}))),"retailerName"==n[3]&&e.sort((function(e,t){return e.retailer.name<t.retailer.name?-1:1})),"-retailerName"===n[3]&&e.sort((function(e,t){return e.retailer.name>t.retailer.name?-1:1})),"leafletName"==n[4]&&e.sort((function(e,t){return e.name<t.name?-1:1})),"-leafletName"==n[4]&&e.sort((function(e,t){return e.name>t.name?-1:1})),console.log(e),console.log(n.join(",")),l({type:i.ActionType.SORT_LEAFLETS,filters:r(r({},a),{sort:n.join(",")}),payload:e})}}},222:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionType=void 0,function(e){e.FETCH_LEAFLETS_PENDING="fetch_leaflets_pending",e.FETCH_LEAFLETS_SUCCESS="fetch_leaflets_success",e.FETCH_LEAFLETS_ERROR="fetch_leaflets_error",e.FILTER_LEAFLETS="filter_Leaflets",e.FILTER_LEAFLETS_BY_NAME="filter_leaflets_by_name",e.FILTER_LEAFLETS_BY_EXPIRED="filter_leaflets_by_expired",e.FILTER_LEAFLETS_BY_RETAILER_ID="filter_leaflets_by_retailer_id",e.FILTER_LEAFLETS_BY_OFFSET_AND_LIMIT="filter_leaflets_by_offset_and_limit",e.FILTER_LEAFLETS_BY_DISTANCE="filter_leaflets_by_distance",e.SORT_LEAFLETS="sort_leaflets"}(t.ActionType||(t.ActionType={}))},228:function(e,t,a){a(229),e.exports=a(471)},229:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a(230),a(470)},471:function(e,t,a){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=r(a(0)),n=r(a(52)),i=r(a(476)),u=a(162),f=r(a(510));a(514),n.default.render(l.default.createElement(u.Provider,{store:f.default},l.default.createElement(i.default,null)),document.getElementById("root"))},476:function(e,t,a){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var l in t=arguments[a])Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l]);return e}).apply(this,arguments)},l=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,r){void 0===r&&(r=a),e[r]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&l(t,e,a);return n(t,e),t},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var f=i(a(0)),s=a(162),o=a(213),c=u(a(223)),d=u(a(500)),m=u(a(164)),p=u(a(501)),E=u(a(504));t.default=function(){var e=(0,s.useDispatch)(),t=(0,s.useSelector)((function(e){return e.leafletsReducer.filters})),a=(0,s.useSelector)((function(e){return e.leafletsReducer.filteredLeaflets}));(0,f.useEffect)((function(){e((0,o.fetchLeaflets)(t,!1))}),[]);var l=a.map((function(e){return f.default.createElement(m.default,{key:e.id.toString(),xs:12,sm:6,md:6,xl:3},f.default.createElement(p.default,r({},e)))}));return f.default.createElement(f.default.Fragment,null,f.default.createElement(E.default,null),f.default.createElement(c.default,null,f.default.createElement(d.default,null,l)))}},501:function(e,t,a){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=a(502);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r(l).default}})},502:function(e,t,a){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=r(a(0));a(503);var n=r(a(518)),i=r(a(519));t.default=function(e){var t,a;return l.default.createElement(n.default,{className:"layout"},l.default.createElement(n.default.Img,{variant:"top",src:e.retailer.images.lg}),l.default.createElement(i.default,null,l.default.createElement(i.default.Item,null,l.default.createElement("span",{className:"list-title"},"Name:"),e.name),l.default.createElement(i.default.Item,null,l.default.createElement("span",{className:"list-title"},"Retailer:"),e.retailer.name),l.default.createElement(i.default.Item,null,l.default.createElement("span",{className:"list-title"},"Distance:"),e.retailer.distance),l.default.createElement(i.default.Item,null,l.default.createElement("span",{className:"list-title"},"Expiration:"),(t=e.expTimestamp,(a=new Date(0)).setUTCSeconds(t),a.toLocaleString())),l.default.createElement(i.default.Item,null,l.default.createElement("span",{className:"list-title"},"Priority:"),e.retailer.priority)))}},503:function(e,t,a){},504:function(e,t,a){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=a(505);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r(l).default}})},505:function(e,t,a){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var l in t=arguments[a])Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l]);return e}).apply(this,arguments)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=l(a(0)),i=l(a(516)),u=l(a(520)),f=l(a(508)),s=l(a(165)),o=l(a(517)),c=l(a(515)),d=l(a(223)),m=l(a(166)),p=a(162),E=a(213);a(509);t.default=function(){var e=(0,p.useDispatch)(),t=(0,p.useSelector)((function(e){return e.leafletsReducer.filters})),a=(0,p.useSelector)((function(e){return e.leafletsReducer.leaflets})),l=(0,p.useSelector)((function(e){return e.leafletsReducer.retailers})),_=function(e){return t.sort.indexOf(e)};t.sort.indexOf("-priority");var y,v=l.map((function(l){return n.default.createElement(c.default.Item,{key:l.id,active:l.id==t.retailerId,onClick:function(n){return e((0,E.filterLeaflets)(a,r(r({},t),{retailerId:l.id})))},as:"li"},l.name)}));return n.default.createElement(i.default,{sticky:"top",bg:"light",expand:"lg"},n.default.createElement(d.default,null,n.default.createElement(i.default.Toggle,{"aria-controls":"basic-navbar-nav"}),n.default.createElement(i.default.Collapse,{id:"basic-navbar-nav"},n.default.createElement(u.default,{className:"m-auto"},n.default.createElement(u.default.Item,null,n.default.createElement(o.default.Group,null,n.default.createElement(s.default,{placeholder:"Search name or retailer","aria-label":"Search",onChange:function(l){return e((0,E.filterLeaflets)(a,r(r({},t),{name:l.target.value})))}}))),n.default.createElement(c.default,{title:"Sort by",id:"basic-nav-dropdown"},n.default.createElement(c.default.Item,{onClick:function(r){return e((0,E.sortLeaflets)(a,-1!==_("-priority")?"priority":"-priority",t))}},n.default.createElement("span",{className:"mr-3"},-1!==_("-priority")?"▼":"▲"),"Priority"),n.default.createElement(c.default.Item,{onClick:function(r){return e((0,E.sortLeaflets)(a,-1!==_("-expTimestamp")?"expTimestamp":"-expTimestamp",t))}},n.default.createElement("span",{className:"pr-3"},-1!==_("-expTimestamp")?"▼":"▲"),"ExpTimestamp"),n.default.createElement(c.default.Item,{onClick:function(r){return e((0,E.sortLeaflets)(a,-1!==_("-distance")?"distance":"-distance",t))}},n.default.createElement("span",{className:"pr-3"},-1!==_("-distance")?"▼":"▲"),"Distance"),n.default.createElement(c.default.Item,{onClick:function(r){return e((0,E.sortLeaflets)(a,-1!==_("-retailerName")?"retailerName":"-retailerName",t))}},n.default.createElement("span",{className:"pr-3"},-1!==_("-retailerName")?"▼":"▲"),"Retailer name"),n.default.createElement(c.default.Item,{onClick:function(r){return e((0,E.sortLeaflets)(a,-1!==_("-leafletName")?"leafletName":"-leafletName",t))}},n.default.createElement("span",{className:"pr-3"},-1!==_("-leafletName")?"▼":"▲"),"Leaflet name")),n.default.createElement(c.default,{title:"Set offset and limit",id:"basic-nav-dropdown"},n.default.createElement(u.default.Item,{className:"p-2"},n.default.createElement(o.default,null,n.default.createElement(o.default.Group,null,n.default.createElement(o.default.Label,null,"Offset:"),n.default.createElement(o.default.Control,{required:!0,name:"offset",type:"number",value:t.offset,onChange:function(l){return e((0,E.filterLeaflets)(a,r(r({},t),{offset:parseInt(l.target.value)})))}})))),n.default.createElement(u.default.Item,{className:"p-2"},n.default.createElement(o.default,null,n.default.createElement(o.default.Group,null,n.default.createElement(o.default.Label,null,"Limit:"),n.default.createElement(o.default.Control,{required:!0,name:"limit",type:"number",value:t.limit,onChange:function(l){return e((0,E.filterLeaflets)(a,r(r({},t),{limit:parseInt(l.target.value)})))}}))))),n.default.createElement(c.default,{className:"retailers-dropdown",title:""!=t.retailerId?(y=t.retailerId,l.filter((function(e){return e.id==y}))[0].name):"Filter by retailer",id:"basic-nav-dropdown"},n.default.createElement(c.default.Item,{onClick:function(l){return e((0,E.filterLeaflets)(a,r(r({},t),{retailerId:""})))}},"None"),v),n.default.createElement(u.default.Item,null,n.default.createElement(f.default,null,n.default.createElement("span",{className:"nav-link"},"Distance:"),n.default.createElement(s.default,{type:"number",className:"distance-box",value:t.maxDistance,onChange:function(l){return e((0,E.filterLeaflets)(a,r(r({},t),{maxDistance:parseInt(l.target.value)})))},placeholder:"Max distance"}))),n.default.createElement(u.default.Item,{className:"ml-4"},n.default.createElement(o.default,{className:"nav-link"},n.default.createElement(o.default.Check,{type:"checkbox",id:"exclude-expired",onChange:function(l){return e((0,E.filterLeaflets)(a,r(r({},t),{excludeExpired:l.target.checked?1:0})))},label:"Exclude expired"}))),n.default.createElement(u.default.Item,null,n.default.createElement(m.default,{variant:"primary",onClick:function(){return e((0,E.fetchLeaflets)(t,!0))}},"Fetch from API")," ")))))}},509:function(e,t,a){},510:function(e,t,a){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=a(224),n=r(a(511)),i=r(a(512)),u=(0,l.createStore)(i.default,(0,l.applyMiddleware)(n.default));t.default=u},512:function(e,t,a){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=a(224),n=r(a(513)),i=(0,l.combineReducers)({leafletsReducer:n.default});t.default=i},513:function(e,t,a){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var l in t=arguments[a])Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var l=a(222),n={loading:!1,leaflets:[],retailers:[],filteredLeaflets:[],filters:{offset:0,limit:30,name:"",retailerId:"",excludeExpired:0,maxDistance:0,sort:"priority,expTimestamp,distance,retailerName,leafletName"}};t.default=function(e,t){switch(void 0===e&&(e=n),t.type){case l.ActionType.FETCH_LEAFLETS_PENDING:return r(r({},e),{loading:!0});case l.ActionType.FETCH_LEAFLETS_SUCCESS:return t.refresh?(console.log("refreshing from API"),r(r({},e),{loading:!1,response:t.payload,filteredLeaflets:t.payload.data.leaflets})):r(r({},e),{loading:!1,response:t.payload,retailers:t.retailers,leaflets:t.payload.data.leaflets,filteredLeaflets:t.payload.data.leaflets});case l.ActionType.FETCH_LEAFLETS_ERROR:return r(r({},e),{loading:!1,error:t.error});case l.ActionType.FILTER_LEAFLETS:case l.ActionType.SORT_LEAFLETS:return r(r({},e),{filteredLeaflets:t.payload,filters:t.filters});default:return e}}},514:function(e,t,a){}},[[228,1,2]]]);
//# sourceMappingURL=app.03c5e2dee06dad6340e1.min.js.map